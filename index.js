const t=async t=>{const e=`https://cdn.jsdelivr.net/npm/hanzi-writer-data/${t}.json`,r=await fetch(e,{cache:"no-store"}),n=await r.json(),o=[];for(let t=0;t<Math.min(n.strokes.length,n.medians.length);t+=1)o.push({clipPath:n.strokes[t],strokePath:n.medians[t].map(((t,e)=>[0===e?"M":"L",t[0].toString(),t[1].toString()].join(" "))).join(" ")});return{character:t,strokeWidth:128,strokes:o,transform:"scale(1, -1) translate(0, -900)",type:"zh",viewBox:"0 0 1024 1024"}},e=async t=>{const e=t.codePointAt(0)?.toString(16).padStart(5,"0");if(void 0===e)throw new Error("characterCode is undefined!");const r=`https://cdn.jsdelivr.net/gh/KanjiVG/kanjivg/kanji/${`${e}.svg`}`,n=await fetch(r,{cache:"no-store"}),o=await n.text(),i=(new DOMParser).parseFromString(o,"image/svg+xml"),s=i.querySelector("svg")?.getAttribute("viewBox");if(null==s)throw new Error("viewBox is null or undefined!");const a=Array.from(i.querySelectorAll("path")).sort(((t,e)=>{const[r,n]=[t,e].map((t=>{const e=t.getAttribute("id");if(null===e)throw new Error("id is null!");return parseInt(e.substring(e.indexOf("-s")),10)}));return r-n})).map((t=>{const e=t.getAttribute("d");if(null===e)throw new Error("d is null!");return e})).map((t=>({clipPath:null,strokePath:t}))),l=Array.from(i.querySelectorAll("g[style]")).map((t=>parseFloat(t.style.getPropertyValue("stroke-width")))).find((t=>!isNaN(t)&&isFinite(t)));if(void 0===l)throw new Error("strokeWidth is undefined!");return{character:t,strokeWidth:l,strokes:a,transform:null,type:"ja",viewBox:s}},r=t=>{const{pauseRatio:e,totalStrokeDuration:r}=t;if(isNaN(e))throw new RangeError("pauseRatio is NaN!");if(e<0)throw new RangeError("pauseRatio cannot be < 0!");if(e>=1)throw new RangeError("pauseRatio cannot be >= 1!");if(isNaN(r))throw new RangeError("totalStrokeDuration is NaN!");if(r<=0)throw new RangeError("totalStrokeDuration cannnot be <= 0!");if(!isFinite(r))throw new RangeError("totalStrokeDuration must be finite!")},n=(t,e,r)=>{const n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.setAttributeNS(null,"x1",t.x.toString()),n.setAttributeNS(null,"y1",t.y.toString()),n.setAttributeNS(null,"x2",e.x.toString()),n.setAttributeNS(null,"y2",e.y.toString()),n.setAttributeNS(null,"stroke",r),n.setAttributeNS(null,"stroke-width","1%"),n},o=(t,e)=>{const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttributeNS(null,"viewBox",t.viewBox),e.includeGrid&&(t=>{const e=t.getAttribute("viewBox");if(null===e)throw new Error("svg element has no viewBox");const[,,r,o]=e.split(" ").map((t=>parseInt(t,10)));t.appendChild(n({x:r/2,y:0},{x:r/2,y:o},"#DDD")),t.appendChild(n({x:0,y:o/2},{x:r,y:o/2},"#DDD"))})(r);const o=document.createElementNS("http://www.w3.org/2000/svg","g");null!==t.transform&&o.setAttributeNS(null,"transform",t.transform),r.appendChild(o);const i=[],s=[];for(let e=0;e<t.strokes.length;e+=1){const r=t.strokes[e],n=document.createElementNS("http://www.w3.org/2000/svg","path");if(n.setAttributeNS(null,"d",r.strokePath),i.push(Math.ceil(n.getTotalLength())),null!==r.clipPath){const i=document.createElementNS("http://www.w3.org/2000/svg","clipPath");i.setAttributeNS(null,"id",`${t.type}-clipPath-${e}`),o.appendChild(i);const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttributeNS(null,"d",r.clipPath),i.appendChild(s),n.setAttributeNS(null,"clip-path",`url(#${t.type}-clipPath-${e})`)}const a=`${t.type}-strokePath-${e}`;s.push(a),n.setAttributeNS(null,"id",a),n.setAttributeNS(null,"fill","none"),n.setAttributeNS(null,"stroke","#000"),n.setAttributeNS(null,"stroke-linecap","round"),n.setAttributeNS(null,"stroke-linejoin","round"),o.appendChild(n)}const a=((t,e,r,n,o)=>{const i=Math.min(t.length,e.length),s=document.createElementNS("http://www.w3.org/2000/svg","style"),a=[],l=n*i;for(let s=0;s<i;s+=1){const u=t[s],h=e[s],p=s/i*100,c=(s+(1-o))/i*100,d=s*n;a.push(`@keyframes dash-${h}`),a.push("{"),d>0&&a.push(`0% { stroke-dasharray: 0 ${u}; }`),a.push(`${p}% { stroke-dasharray: 0 ${u}; animation-timing-function: linear; }`),c<100&&a.push(`${c}% { stroke-dasharray: ${u} 0; }`),a.push(`100% { stroke-dasharray: ${u} 0; }`),a.push("}"),a.push(`@keyframes width-${h}`),a.push("{"),d>0&&a.push("0% { stroke-width: 0; animation-timing-function: steps(1, end); }"),a.push(`${p}% { stroke-width: ${r}; }`),c<100&&a.push(`${c}% { stroke-width: ${r}; }`),a.push(`100% { stroke-width: ${r}; }`),a.push("}"),a.push(`#${h} { animation: dash-${h} ${l}s infinite, width-${h} ${l}s infinite; }`)}return s.appendChild(document.createTextNode(a.join(" "))),s})(i,s,t.strokeWidth,e.totalStrokeDuration,e.pauseRatio);return o.appendChild(a),r},i=(n,i,s)=>{const a={includeGrid:void 0===s.includeGrid||s.includeGrid,pauseRatio:void 0===s.pauseRatio?.2:s.pauseRatio,totalStrokeDuration:void 0===s.totalStrokeDuration?1:s.totalStrokeDuration};if(r(a),"zh"===n&&"svg"===i)return async e=>{const r=await t(e);return o(r,a)};if("ja"===n&&"svg"===i)return async t=>{const r=await e(t);return o(r,a)};throw new Error("Unsupported lang or output!")},s=t=>{const e=document.createElement("img");return e.src=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml"})),e};export{i as strokes,s as svgToImg};